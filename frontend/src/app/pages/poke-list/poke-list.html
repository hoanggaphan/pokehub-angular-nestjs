<div class="container mx-auto p-4 space-y-4">
  <div class="flex flex-wrap items-end gap-3">
    <div>
      <label class="block text-xs mb-1">Search</label>
      <input class="border rounded px-3 py-2 w-64" type="text" [ngModel]="q()" (ngModelChange)="q.set($event); store.searchByName($event)" placeholder="Search by name..." [disabled]="store.isEmptyInitialState()" />
    </div>
    <div>
      <label class="block text-xs mb-1">Type</label>
      <input class="border rounded px-3 py-2 w-40" type="text" [ngModel]="type()" (ngModelChange)="type.set($event || undefined); store.updateFilter({ type: $event || undefined, page: 1 }); store.load()" placeholder="e.g. Fire" [disabled]="store.isEmptyInitialState()" />
    </div>
    <div>
      <label class="block text-xs mb-1">Legendary</label>
      <select class="border rounded px-3 py-2" [ngModel]="legendary()" (ngModelChange)="legendary.set($event); store.updateFilter({ legendary: $event === '' ? null : $event === 'true', page: 1 }); store.load()" [disabled]="store.isEmptyInitialState()">
        <option value="">Any</option>
        <option value="true">Yes</option>
        <option value="false">No</option>
      </select>
    </div>
    <div>
      <label class="block text-xs mb-1">Speed min</label>
      <input class="border rounded px-3 py-2 w-24" type="number" [ngModel]="speedMin()" (ngModelChange)="speedMin.set($event); store.updateFilter({ speedMin: $event === null || $event === '' ? null : (+$event), page: 1 }); store.load()" [disabled]="store.isEmptyInitialState()" />
    </div>
    <div>
      <label class="block text-xs mb-1">Speed max</label>
      <input class="border rounded px-3 py-2 w-24" type="number" [ngModel]="speedMax()" (ngModelChange)="speedMax.set($event); store.updateFilter({ speedMax: $event === null || $event === '' ? null : (+$event), page: 1 }); store.load()" [disabled]="store.isEmptyInitialState()" />
    </div>
    <div class="ml-auto">
      <app-import (imported)="store.load()" />
    </div>
  </div>

  <div class="flex items-center justify-between">
    <div class="text-sm opacity-80">Total: {{ store.total() }} ¬∑ Page {{ store.page() }} / {{ store.pageCount() }}</div>
    <div class="flex items-center gap-2">
      <span class="text-sm">Per page</span>
      <select class="border rounded px-2 py-1" [ngModel]="store.limit()" (ngModelChange)="store.setLimit($event); store.load()" [disabled]="store.isEmptyInitialState()">
        @for (n of limits; track n) { <option [ngValue]="n">{{ n }}</option> }
      </select>
    </div>
  </div>

  @if (store.isLoading()) {
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      @for (s of skeletonItems; track s) {
        <div class="card-skeleton">
          <div class="skel-thumb shimmer"></div>
          <div class="skel-title shimmer"></div>
          <div class="skel-badges">
            <span class="skel-badge shimmer"></span>
            <span class="skel-badge shimmer"></span>
          </div>
          <div class="skel-actions">
            <span class="skel-btn shimmer"></span>
            <span class="skel-btn shimmer"></span>
          </div>
        </div>
      }
    </div>
  } @else if (store.isEmptyInitialState()) {
    <div class="empty-state">
      <div class="empty-illustration">üåü</div>
      <h3>Your Pok√©mon World is Empty!</h3>
      <p>Start building your collection by importing your favorite Pok√©mon or catching new ones in the wild.</p>
      <div class="empty-actions">
        <app-import-your-world (imported)="store.load()" />
        <button class="btn-catch" (click)="navigateToCatch()">
          <span class="material-icons">catching_pokemon</span>
          Go Catching
        </button>
      </div>
      <div class="empty-features">
        <div class="feature-card">
          <div class="feature-icon">üìä</div>
          <h4>Import CSV</h4>
          <p>Upload your Pok√©mon collection from a CSV file</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üéØ</div>
          <h4>Catch Pok√©mon</h4>
          <p>Discover and catch new Pok√©mon in the wild</p>
        </div>
      </div>
    </div>
  } @else if (store.hasNoSearchResults()) {
    <div class="no-results-state">
      <div class="no-results-illustration">üîç</div>
      <h3>No Pok√©mon Found</h3>
      <p>Try adjusting your search criteria or filters to find more Pok√©mon.</p>
      <button class="btn-clear-filters" (click)="clearFilters()">
        <span class="material-icons">clear</span>
        Clear Filters
      </button>
    </div>
  } @else {
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      @for (p of store.sortedPokemon(); track p.id) {
        <app-pokemon-card [pokemon]="p" [favorite]="favoriteIdSet().has(p.id)" (toggleFavorite)="handleToggleFavorite($event)" (view)="openDetail($event)" />
      }
    </div>
  }

  <div class="flex items-center justify-center gap-2">
    <button class="border rounded px-3 py-1" [disabled]="store.page() <= 1 || store.isEmptyInitialState()" (click)="store.setPage(store.page() - 1); store.load()">Prev</button>
    <button class="border rounded px-3 py-1" [disabled]="store.page() >= store.pageCount() || store.isEmptyInitialState()" (click)="store.setPage(store.page() + 1); store.load()">Next</button>
  </div>

  @if (selectedPokemon()) {
    <app-pokemon-detail-modal [pokemon]="selectedPokemon()!" [favorite]="favoriteIdSet().has(selectedPokemon()!.id)" (toggleFavorite)="handleToggleFavorite($event)" (closed)="closeDetail()" />
  }
</div>

